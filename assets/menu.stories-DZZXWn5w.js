import{l as g,a as h,u as ne,r as j,j as e,d as ae,f as oe,s as re,g as ie,h as ce,i as M,k as le,C as ue,D as de,E as me,F as he,G as S}from"./iframe-BRWzqT9J.js";import{q as ge,T as pe}from"./extract-BJCNn7ce.js";import{P as be}from"./Point-CTISuSl7.js";import{a as A}from"./language-BZZFEiCU.js";import{O as fe}from"./language-bavONDnL.js";import{O as xe}from"./user_guide-D1_2ASK0.js";import{u as ye}from"./useTranslation-BgpURjWR.js";import"./preload-helper-D9Z9MdNV.js";import"./math-4uH4-Zr4.js";import"./string-CY-c2UAi.js";const je=function(t,o){const l=new URL(t+"getegrid/json/");return l.searchParams.append("EN",""+o[0]+","+o[1]),l.searchParams.append("_dc",new Date().getTime()),new Promise((u,d)=>{fetch(l.toString()).then(n=>{n.status===204||n.status>=400?d(n):u(n.json())})})},Ne=function(t,o,l){const u=new URL(t);u.searchParams.append("term",o),u.searchParams.append("lang",l);let d;return{promise:new Promise((N,p)=>{fetch(u.toString()).then(i=>i.json()).then(i=>{N(i)}).catch(i=>{p(i)}),d=function(){p(new Error("Request canceled"))}}),cancel:d}},U=new RegExp("^(\\d{7}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{7}(\\.\\d+)?)"),D=new RegExp("^(\\d{1}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{2}(\\.\\d+)?)"),I=function(t){return g.isArray(t)?[parseFloat(t[1]),parseFloat(t[4])]:null},T=function(t){return U.test(t)},B=function(t){return D.test(t)},O=function(t){if(B(t)){const o=I(D.exec(t));return new be(o).transform("EPSG:4326","EPSG:2056").getCoordinates()}else if(T(t))return I(U.exec(t));return null},v=function(){const{t}=ye(),o=h(s=>s.config).config,l=h(s=>s.availability).visible,u=h(s=>s.symbolZoom).enabled;h(s=>s.extract).highlight,h(s=>s.extract).background;const d=h(s=>s.history).elements.slice().reverse(),n=ne(),N=o.search_url,p=o.service_url,i=h(s=>s.language),f=i.current,R=i.default,_=i.available,[q,L]=j.useState(""),[C,Z]=j.useState(null),[z,P]=j.useState([]),[V,w]=j.useState(!1),F=A(o.application.logo_oereb,f,R),H=A(o.application.logo_canton,f,R);let k=null;g.isArray(_)&&_.length>1&&(k=e.jsx(fe,{}));const x=function(s,a,r){n(ae([])),n(oe({egrid:s,identdn:a,number:r,zoom:!0})),ge(p,s,a,r,o.extract_json_timeout,f).then(m=>{n(re(m)),n(ie(m))}).catch(m=>{m instanceof pe?(n(ce()),n(M(t("extract.error.too_many_requests"),!0))):n(le())})},W=function(s){n(me({posX:s[0],posY:s[1]})),je(p,s).then(a=>{const r=a.GetEGRIDResponse;r.length>1?n(he({results:r})):r.length===1?(n(S()),x(r[0].egrid)):n(S())}).catch(a=>{a.status===429&&n(M(t("extract.error.too_many_requests")),!0),n(S())})},E=function(){L(""),P([])},X=function(s){E(),g.isString(s.egrid)?x(s.egrid,null,null):g.isString(s.identdn)&&g.isString(s.number)?x(null,s.identdn,s.number):g.isArray(s.coordinates)&&W(s.coordinates)},Y=function(s){const a=s.target.value;if(L(a),C!==null&&C.cancel(),a.length>0){w(!0);const r=Ne(N,a,f),m=r.promise;Z(r),m.then(y=>{let c=[];T(a)&&(c=c.concat([{title:t("menu.search.title.coordinates.lv95"),results:[{label:a,coordinates:O(a)}]}])),B(a)&&(c=c.concat([{title:t("menu.search.title.coordinates.wgs84"),results:[{label:a,coordinates:O(a)}]}])),c=c.concat(y),P(c),w(!1)}).catch(()=>{w(!1)})}else E()},J=z.map((s,a)=>{if(s.results.length>0){const r=s.results.map((y,c)=>e.jsx("button",{className:"list-group-item list-group-item-action search-result text-start",onClick:X.bind(this,y),children:y.label},c));return e.jsxs("div",{className:"list-group result-list",children:[e.jsxs("div",{className:"list-group-item",children:[e.jsx("strong",{children:s.title}),e.jsx("span",{className:"badge bg-secondary float-end",children:s.results.length})]}),r]},a)}return null}),K=function(){return q.length===0?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",title:t("menu.search.reset"),disabled:!0,children:e.jsx("i",{className:"bi bi-trash"})}):V?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",disabled:!0,children:e.jsx("span",{className:"spinner-grow spinner-grow-sm",role:"status"})}):e.jsx("button",{onClick:E,className:"btn btn-outline-secondary",title:t("menu.search.reset"),type:"button",children:e.jsx("i",{className:"bi bi-trash"})})}(),Q=l?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.availability")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.availability")]}),$=function(){n(ue(!l))},ee=u?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.symbol_zoom")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.symbol_zoom")]}),se=function(){n(de(!u))},te=d.map((s,a)=>e.jsx("li",{children:e.jsxs("button",{className:"dropdown-item",onClick:x.bind(this,s.EGRID,s.IdentDN,s.Number),children:[s.Municipality," ",s.Number," (",s.EGRID,")"]})},a));let G="btn btn-outline-secondary dropdown-toggle";return d.length<1&&(G+=" disabled"),e.jsxs("div",{className:"oereb-client-menu d-flex flex-column pb-3",children:[e.jsxs("div",{className:"flex-grow-1 row justify-content-evenly",children:[e.jsx("div",{className:"col",children:e.jsx("img",{className:"img-fluid p-2",src:F})}),e.jsx("div",{className:"col text-end",children:e.jsx("img",{className:"img-fluid p-2",src:H})})]}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"input-group",children:[k,e.jsx("button",{className:"btn btn-outline-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.settings.title"),children:e.jsx("i",{className:"bi bi-gear-fill"})}),e.jsxs("ul",{className:"dropdown-menu",children:[e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:$,children:Q})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:se,children:ee})})]}),e.jsx("button",{className:G,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.history.title"),children:e.jsx("i",{className:"bi bi-clock-history"})}),e.jsx("ul",{className:"dropdown-menu",children:te}),e.jsx("input",{type:"text",className:"form-control",value:q,onChange:Y,placeholder:t("menu.search.placeholder")}),K,e.jsx(xe,{})]})}),e.jsx("div",{className:"container-fluid",children:J})]})};v.__docgenInfo={description:"",methods:[],displayName:"OerebMenu"};const Ge={title:"API Reference/Component/Menu",component:v,tags:["autodocs"]},b=()=>e.jsx(v,{});b.__docgenInfo={description:"",methods:[],displayName:"Menu"};b.parameters={...b.parameters,docs:{...b.parameters?.docs,source:{originalSource:"() => <OerebMenu />",...b.parameters?.docs?.source}}};const Me=["Menu"];export{b as Menu,Me as __namedExportsOrder,Ge as default};
