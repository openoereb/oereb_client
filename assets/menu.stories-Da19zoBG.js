import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as y}from"./index-F28aNuxU.js";import{l as h}from"./lodash-De1oY7As.js";import{a as m,u as re}from"./react-redux-DiBVDDrZ.js";import{b as ae}from"./accordion-DVxJyVYp.js";import{s as ie,e as ce}from"./symbol_zoom-DkXb3HEk.js";import{l as le,s as ue,a as de}from"./extract-CnYWO0Dc.js";import{u as me}from"./history-BG0oPCma.js";import{l as he,s as pe,h as v}from"./map_query-CR0kVy1Z.js";import{q as ge}from"./extract--okyu-24.js";import{P as be}from"./Point-ZKaAhP8A.js";import{a as G}from"./language-0ROrJ-Cb.js";import{O as fe}from"./language-DKyvPOE5.js";import{O as xe}from"./user_guide-D0xrqnyp.js";import{u as je}from"./useTranslation-HHJENg9B.js";import"./redux-toolkit.modern-DkWCaux4.js";import"./math-CqhxGUwT.js";import"./language-Ja54RKjN.js";import"./iframe-_WNx4s3R.js";import"./i18nInstance-DBIXdvxg.js";import"./string-CSEs8Pm1.js";import"./context-2JaK5s97.js";const ye=function(t,r){const l=new URL(t+"getegrid/json/");return l.searchParams.append("EN",""+r[0]+","+r[1]),l.searchParams.append("_dc",new Date().getTime()),new Promise((u,d)=>{fetch(l.toString()).then(n=>{n.status===204||n.status>=400?d(n):u(n.json())})})},Ne=function(t,r,l){const u=new URL(t);u.searchParams.append("term",r),u.searchParams.append("lang",l);let d;return{promise:new Promise((N,p)=>{fetch(u.toString()).then(i=>i.json()).then(i=>{N(i)}).catch(i=>{p(i)}),d=function(){p(new Error("Request canceled"))}}),cancel:d}},D=new RegExp("^(\\d{7}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{7}(\\.\\d+)?)"),T=new RegExp("^(\\d{1}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{2}(\\.\\d+)?)"),M=function(t){return h.isArray(t)?[parseFloat(t[1]),parseFloat(t[4])]:null},Z=function(t){return D.test(t)},z=function(t){return T.test(t)},I=function(t){if(z(t)){const r=M(T.exec(t));return new be(r).transform("EPSG:4326","EPSG:2056").getCoordinates()}else if(Z(t))return M(D.exec(t));return null},E=function(){const{t}=je(),r=m(s=>s.config).config,l=m(s=>s.availability).visible,u=m(s=>s.symbolZoom).enabled;m(s=>s.extract).highlight,m(s=>s.extract).background;const d=m(s=>s.history).elements.slice().reverse(),n=re(),N=r.search_url,p=r.service_url,i=m(s=>s.language),f=i.current,R=i.default,_=i.available,[L,q]=y.useState(""),[P,V]=y.useState(null),[F,C]=y.useState([]),[H,w]=y.useState(!1),X=G(r.application.logo_oereb,f,R),Y=G(r.application.logo_canton,f,R);let k=null;h.isArray(_)&&_.length>1&&(k=e.jsx(fe,{}));const x=function(s,o,a){n(ae([])),n(le({egrid:s,identdn:o,number:a,zoom:!0})),ge(p,s,o,a,r.extract_json_timeout,f).then(g=>{n(ue(g)),n(me(g))}).catch(()=>{n(de())})},J=function(s){n(he({posX:s[0],posY:s[1]})),ye(p,s).then(o=>{const a=o.GetEGRIDResponse;a.length>1?n(pe({results:a})):a.length===1?(n(v()),x(a[0].egrid)):n(v())}).catch(()=>{n(v())})},S=function(){q(""),C([])},K=function(s){S(),h.isString(s.egrid)?x(s.egrid,null,null):h.isString(s.identdn)&&h.isString(s.number)?x(null,s.identdn,s.number):h.isArray(s.coordinates)&&J(s.coordinates)},Q=function(s){const o=s.target.value;if(q(o),P!==null&&P.cancel(),o.length>0){w(!0);const a=Ne(N,o,f),g=a.promise;V(a),g.then(j=>{let c=[];Z(o)&&(c=c.concat([{title:t("menu.search.title.coordinates.lv95"),results:[{label:o,coordinates:I(o)}]}])),z(o)&&(c=c.concat([{title:t("menu.search.title.coordinates.wgs84"),results:[{label:o,coordinates:I(o)}]}])),c=c.concat(j),C(c),w(!1)}).catch(()=>{w(!1)})}else S()},W=F.map((s,o)=>{if(s.results.length>0){const a=s.results.map((j,c)=>e.jsx("button",{className:"list-group-item list-group-item-action search-result text-start",onClick:K.bind(this,j),children:j.label},c));return e.jsxs("div",{className:"list-group result-list",children:[e.jsxs("div",{className:"list-group-item",children:[e.jsx("strong",{children:s.title}),e.jsx("span",{className:"badge bg-secondary float-end",children:s.results.length})]}),a]},o)}return null}),$=function(){return L.length===0?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",title:t("menu.search.reset"),disabled:!0,children:e.jsx("i",{className:"bi bi-trash"})}):H?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",disabled:!0,children:e.jsx("span",{className:"spinner-grow spinner-grow-sm",role:"status"})}):e.jsx("button",{onClick:S,className:"btn btn-outline-secondary",title:t("menu.search.reset"),type:"button",children:e.jsx("i",{className:"bi bi-trash"})})}(),ee=l?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.availability")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.availability")]}),se=function(){n(ie(!l))},te=u?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.symbol_zoom")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.symbol_zoom")]}),ne=function(){n(ce(!u))},oe=d.map((s,o)=>e.jsx("li",{children:e.jsxs("button",{className:"dropdown-item",onClick:x.bind(this,s.EGRID,s.IdentDN,s.Number),children:[s.Municipality," ",s.Number," (",s.EGRID,")"]})},o));let A="btn btn-outline-secondary dropdown-toggle";return d.length<1&&(A+=" disabled"),e.jsxs("div",{className:"oereb-client-menu d-flex flex-column pb-3",children:[e.jsxs("div",{className:"flex-grow-1 row justify-content-evenly",children:[e.jsx("div",{className:"col",children:e.jsx("img",{className:"img-fluid p-2",src:X})}),e.jsx("div",{className:"col text-end",children:e.jsx("img",{className:"img-fluid p-2",src:Y})})]}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"input-group",children:[k,e.jsx("button",{className:"btn btn-outline-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.settings.title"),children:e.jsx("i",{className:"bi bi-gear-fill"})}),e.jsxs("ul",{className:"dropdown-menu",children:[e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:se,children:ee})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:ne,children:te})})]}),e.jsx("button",{className:A,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.history.title"),children:e.jsx("i",{className:"bi bi-clock-history"})}),e.jsx("ul",{className:"dropdown-menu",children:oe}),e.jsx("input",{type:"text",className:"form-control",value:L,onChange:Q,placeholder:t("menu.search.placeholder")}),$,e.jsx(xe,{})]})}),e.jsx("div",{className:"container-fluid",children:W})]})};E.__docgenInfo={description:"",methods:[],displayName:"OerebMenu"};const Fe={title:"API Reference/Component/Menu",component:E},b=()=>e.jsx(E,{});b.__docgenInfo={description:"",methods:[],displayName:"Menu"};var O,U,B;b.parameters={...b.parameters,docs:{...(O=b.parameters)==null?void 0:O.docs,source:{originalSource:"() => <OerebMenu />",...(B=(U=b.parameters)==null?void 0:U.docs)==null?void 0:B.source}}};const He=["Menu"];export{b as Menu,He as __namedExportsOrder,Fe as default};
