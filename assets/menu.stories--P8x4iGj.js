import{l as h,a as m,u as oe,r as y,j as e,d as re,f as ie,s as ce,g as le,h as ue,B as de,C as me,D as he,E as ge,F as v}from"./iframe-BVmJ0_b8.js";import{q as pe}from"./extract-DkCJk1PC.js";import{P as be}from"./Point-_Mh_83a2.js";import{a as G}from"./language-phDyDfJq.js";import{O as fe}from"./language-_buaPMkt.js";import{O as xe}from"./user_guide-0CMsoHtW.js";import{u as je}from"./useTranslation-zUGwAzKY.js";import"./math-4uH4-Zr4.js";import"./string-BYUjZH2Q.js";const ye=function(t,o){const l=new URL(t+"getegrid/json/");return l.searchParams.append("EN",""+o[0]+","+o[1]),l.searchParams.append("_dc",new Date().getTime()),new Promise((u,d)=>{fetch(l.toString()).then(n=>{n.status===204||n.status>=400?d(n):u(n.json())})})},Ne=function(t,o,l){const u=new URL(t);u.searchParams.append("term",o),u.searchParams.append("lang",l);let d;return{promise:new Promise((N,g)=>{fetch(u.toString()).then(i=>i.json()).then(i=>{N(i)}).catch(i=>{g(i)}),d=function(){g(new Error("Request canceled"))}}),cancel:d}},D=new RegExp("^(\\d{7}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{7}(\\.\\d+)?)"),T=new RegExp("^(\\d{1}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{2}(\\.\\d+)?)"),M=function(t){return h.isArray(t)?[parseFloat(t[1]),parseFloat(t[4])]:null},Z=function(t){return D.test(t)},z=function(t){return T.test(t)},I=function(t){if(z(t)){const o=M(T.exec(t));return new be(o).transform("EPSG:4326","EPSG:2056").getCoordinates()}else if(Z(t))return M(D.exec(t));return null},E=function(){const{t}=je(),o=m(s=>s.config).config,l=m(s=>s.availability).visible,u=m(s=>s.symbolZoom).enabled;m(s=>s.extract).highlight,m(s=>s.extract).background;const d=m(s=>s.history).elements.slice().reverse(),n=oe(),N=o.search_url,g=o.service_url,i=m(s=>s.language),f=i.current,R=i.default,_=i.available,[L,q]=y.useState(""),[C,V]=y.useState(null),[F,P]=y.useState([]),[H,w]=y.useState(!1),X=G(o.application.logo_oereb,f,R),Y=G(o.application.logo_canton,f,R);let k=null;h.isArray(_)&&_.length>1&&(k=e.jsx(fe,{}));const x=function(s,a,r){n(re([])),n(ie({egrid:s,identdn:a,number:r,zoom:!0})),pe(g,s,a,r,o.extract_json_timeout,f).then(p=>{n(ce(p)),n(le(p))}).catch(()=>{n(ue())})},J=function(s){n(he({posX:s[0],posY:s[1]})),ye(g,s).then(a=>{const r=a.GetEGRIDResponse;r.length>1?n(ge({results:r})):r.length===1?(n(v()),x(r[0].egrid)):n(v())}).catch(()=>{n(v())})},S=function(){q(""),P([])},K=function(s){S(),h.isString(s.egrid)?x(s.egrid,null,null):h.isString(s.identdn)&&h.isString(s.number)?x(null,s.identdn,s.number):h.isArray(s.coordinates)&&J(s.coordinates)},Q=function(s){const a=s.target.value;if(q(a),C!==null&&C.cancel(),a.length>0){w(!0);const r=Ne(N,a,f),p=r.promise;V(r),p.then(j=>{let c=[];Z(a)&&(c=c.concat([{title:t("menu.search.title.coordinates.lv95"),results:[{label:a,coordinates:I(a)}]}])),z(a)&&(c=c.concat([{title:t("menu.search.title.coordinates.wgs84"),results:[{label:a,coordinates:I(a)}]}])),c=c.concat(j),P(c),w(!1)}).catch(()=>{w(!1)})}else S()},W=F.map((s,a)=>{if(s.results.length>0){const r=s.results.map((j,c)=>e.jsx("button",{className:"list-group-item list-group-item-action search-result text-start",onClick:K.bind(this,j),children:j.label},c));return e.jsxs("div",{className:"list-group result-list",children:[e.jsxs("div",{className:"list-group-item",children:[e.jsx("strong",{children:s.title}),e.jsx("span",{className:"badge bg-secondary float-end",children:s.results.length})]}),r]},a)}return null}),$=function(){return L.length===0?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",title:t("menu.search.reset"),disabled:!0,children:e.jsx("i",{className:"bi bi-trash"})}):H?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",disabled:!0,children:e.jsx("span",{className:"spinner-grow spinner-grow-sm",role:"status"})}):e.jsx("button",{onClick:S,className:"btn btn-outline-secondary",title:t("menu.search.reset"),type:"button",children:e.jsx("i",{className:"bi bi-trash"})})}(),ee=l?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.availability")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.availability")]}),se=function(){n(de(!l))},te=u?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.symbol_zoom")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.symbol_zoom")]}),ne=function(){n(me(!u))},ae=d.map((s,a)=>e.jsx("li",{children:e.jsxs("button",{className:"dropdown-item",onClick:x.bind(this,s.EGRID,s.IdentDN,s.Number),children:[s.Municipality," ",s.Number," (",s.EGRID,")"]})},a));let A="btn btn-outline-secondary dropdown-toggle";return d.length<1&&(A+=" disabled"),e.jsxs("div",{className:"oereb-client-menu d-flex flex-column pb-3",children:[e.jsxs("div",{className:"flex-grow-1 row justify-content-evenly",children:[e.jsx("div",{className:"col",children:e.jsx("img",{className:"img-fluid p-2",src:X})}),e.jsx("div",{className:"col text-end",children:e.jsx("img",{className:"img-fluid p-2",src:Y})})]}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"input-group",children:[k,e.jsx("button",{className:"btn btn-outline-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.settings.title"),children:e.jsx("i",{className:"bi bi-gear-fill"})}),e.jsxs("ul",{className:"dropdown-menu",children:[e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:se,children:ee})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:ne,children:te})})]}),e.jsx("button",{className:A,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.history.title"),children:e.jsx("i",{className:"bi bi-clock-history"})}),e.jsx("ul",{className:"dropdown-menu",children:ae}),e.jsx("input",{type:"text",className:"form-control",value:L,onChange:Q,placeholder:t("menu.search.placeholder")}),$,e.jsx(xe,{})]})}),e.jsx("div",{className:"container-fluid",children:W})]})};E.__docgenInfo={description:"",methods:[],displayName:"OerebMenu"};const ke={title:"API Reference/Component/Menu",component:E,tags:["autodocs"]},b=()=>e.jsx(E,{});b.__docgenInfo={description:"",methods:[],displayName:"Menu"};var O,U,B;b.parameters={...b.parameters,docs:{...(O=b.parameters)==null?void 0:O.docs,source:{originalSource:"() => <OerebMenu />",...(B=(U=b.parameters)==null?void 0:U.docs)==null?void 0:B.source}}};const Ae=["Menu"];export{b as Menu,Ae as __namedExportsOrder,ke as default};
