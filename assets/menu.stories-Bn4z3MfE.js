import{j as e}from"./jsx-runtime-BdbbjX0y.js";import{r as y}from"./index-Cllag2AU.js";import{l as h}from"./lodash-Dq-K8hP6.js";import{a as m,u as ae}from"./react-redux-0eJ7qdss.js";import{b as ie}from"./accordion-BmwluRog.js";import{s as ce,e as le}from"./symbol_zoom-C_gA20-V.js";import{l as ue,s as de,a as me}from"./extract-CDmeTfSi.js";import{u as he}from"./history-CtXztCI4.js";import{l as pe,s as ge,h as v}from"./map_query-CKS66cZX.js";import{q as be}from"./extract-BMXaqq6W.js";import{P as fe}from"./Point-D3SwpK0W.js";import{a as k}from"./language-DUM2WhFX.js";import{O as xe}from"./language-DribOlHe.js";import{O as je}from"./user_guide-CIckQFmA.js";import{u as ye}from"./useTranslation-Bpy18lAq.js";import"./redux-toolkit.modern-COmaToQL.js";import"./extent-B4lttSIG.js";import"./language-B_vHzdhj.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./i18nInstance-CGzSW7xh.js";import"./string-ClYSTjH7.js";import"./context-DfVHJ8nK.js";const Ne=function(t,r){const l=new URL(t+"getegrid/json/");return l.searchParams.append("EN",""+r[0]+","+r[1]),l.searchParams.append("_dc",new Date().getTime()),new Promise((u,d)=>{fetch(l.toString()).then(n=>{n.status===204||n.status>=400?d(n):u(n.json())})})},we=function(t,r,l){const u=new URL(t);u.searchParams.append("term",r),u.searchParams.append("lang",l);let d;return{promise:new Promise((N,p)=>{fetch(u.toString()).then(i=>i.json()).then(i=>{N(i)}).catch(i=>{p(i)}),d=function(){p(new Error("Request canceled"))}}),cancel:d}},B=new RegExp("^(\\d{7}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{7}(\\.\\d+)?)"),D=new RegExp("^(\\d{1}(\\.\\d+)?)(\\s|,\\s?|;\\s?)(\\d{2}(\\.\\d+)?)"),A=function(t){return h.isArray(t)?[parseFloat(t[1]),parseFloat(t[4])]:null},T=function(t){return B.test(t)},Z=function(t){return D.test(t)},G=function(t){if(Z(t)){const r=A(D.exec(t));return new fe(r).transform("EPSG:4326","EPSG:2056").getCoordinates()}else if(T(t))return A(B.exec(t));return null},z=function(){const{t}=ye(),r=m(s=>s.config).config,l=m(s=>s.availability).visible,u=m(s=>s.symbolZoom).enabled;m(s=>s.extract).highlight,m(s=>s.extract).background;const d=m(s=>s.history).elements.slice().reverse(),n=ae(),N=r.search_url,p=r.service_url,i=m(s=>s.language),f=i.current,E=i.default,R=i.available,[_,L]=y.useState(""),[q,F]=y.useState(null),[H,P]=y.useState([]),[X,w]=y.useState(!1),Y=k(r.application.logo_oereb,f,E),$=k(r.application.logo_canton,f,E);let C=null;h.isArray(R)&&R.length>1&&(C=e.jsx(xe,{}));const x=function(s,o,a){n(ie([])),n(ue({egrid:s,identdn:o,number:a,zoom:!0})),be(p,s,o,a,r.extract_json_timeout,f).then(g=>{n(de(g)),n(he(g))}).catch(()=>{n(me())})},J=function(s){n(pe({posX:s[0],posY:s[1]})),Ne(p,s).then(o=>{const a=o.GetEGRIDResponse;a.length>1?n(ge({results:a})):a.length===1?(n(v()),x(a[0].egrid)):n(v())}).catch(()=>{n(v())})},S=function(){L(""),P([])},K=function(s){S(),h.isString(s.egrid)?x(s.egrid,null,null):h.isString(s.identdn)&&h.isString(s.number)?x(null,s.identdn,s.number):h.isArray(s.coordinates)&&J(s.coordinates)},Q=function(s){const o=s.target.value;if(L(o),q!==null&&q.cancel(),o.length>0){w(!0);const a=we(N,o,f),g=a.promise;F(a),g.then(j=>{let c=[];T(o)&&(c=c.concat([{title:t("menu.search.title.coordinates.lv95"),results:[{label:o,coordinates:G(o)}]}])),Z(o)&&(c=c.concat([{title:t("menu.search.title.coordinates.wgs84"),results:[{label:o,coordinates:G(o)}]}])),c=c.concat(j),P(c),w(!1)}).catch(()=>{w(!1)})}else S()},W=H.map((s,o)=>{if(s.results.length>0){const a=s.results.map((j,c)=>e.jsx("button",{className:"list-group-item list-group-item-action search-result text-start",onClick:K.bind(this,j),children:j.label},c));return e.jsxs("div",{className:"list-group result-list",children:[e.jsxs("div",{className:"list-group-item",children:[e.jsx("strong",{children:s.title}),e.jsx("span",{className:"badge bg-secondary float-end",children:s.results.length})]}),a]},o)}return null}),ee=function(){return _.length===0?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",title:t("menu.search.reset"),disabled:!0,children:e.jsx("i",{className:"bi bi-trash"})}):X?e.jsx("button",{className:"btn btn-outline-secondary",type:"button",disabled:!0,children:e.jsx("span",{className:"spinner-grow spinner-grow-sm",role:"status"})}):e.jsx("button",{onClick:S,className:"btn btn-outline-secondary",title:t("menu.search.reset"),type:"button",children:e.jsx("i",{className:"bi bi-trash"})})}(),se=l?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.availability")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.availability")]}),te=function(){n(ce(!l))},ne=u?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-check-square"})," ",t("menu.settings.symbol_zoom")]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-square"})," ",t("menu.settings.symbol_zoom")]}),oe=function(){n(le(!u))},re=d.map((s,o)=>e.jsx("li",{children:e.jsxs("button",{className:"dropdown-item",onClick:x.bind(this,s.EGRID,s.IdentDN,s.Number),children:[s.Municipality," ",s.Number," (",s.EGRID,")"]})},o));let M="btn btn-outline-secondary dropdown-toggle";return d.length<1&&(M+=" disabled"),e.jsxs("div",{className:"oereb-client-menu d-flex flex-column pb-3",children:[e.jsxs("div",{className:"flex-grow-1 row justify-content-evenly",children:[e.jsx("div",{className:"col",children:e.jsx("img",{className:"img-fluid p-2",src:Y})}),e.jsx("div",{className:"col text-end",children:e.jsx("img",{className:"img-fluid p-2",src:$})})]}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"input-group",children:[C,e.jsx("button",{className:"btn btn-outline-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.settings.title"),children:e.jsx("i",{className:"bi bi-gear-fill"})}),e.jsxs("ul",{className:"dropdown-menu",children:[e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:te,children:se})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:oe,children:ne})})]}),e.jsx("button",{className:M,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",title:t("menu.history.title"),children:e.jsx("i",{className:"bi bi-clock-history"})}),e.jsx("ul",{className:"dropdown-menu",children:re}),e.jsx("input",{type:"text",className:"form-control",value:_,onChange:Q,placeholder:t("menu.search.placeholder")}),ee,e.jsx(je,{})]})}),e.jsx("div",{className:"container-fluid",children:W})]})},V=z;z.__docgenInfo={description:"",methods:[],displayName:"OerebMenu"};const He={title:"API Reference/Component/Menu",component:V},b=()=>e.jsx(V,{});b.__docgenInfo={description:"",methods:[],displayName:"Menu"};var O,I,U;b.parameters={...b.parameters,docs:{...(O=b.parameters)==null?void 0:O.docs,source:{originalSource:"() => <OerebMenu />",...(U=(I=b.parameters)==null?void 0:I.docs)==null?void 0:U.source}}};const Xe=["Menu"];export{b as Menu,Xe as __namedExportsOrder,He as default};
